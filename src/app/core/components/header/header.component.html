<div class="dialog-overlay" *ngIf="isDialogOpen">
  <div class="dialog-box">
    <h3>Confirmation</h3>
    <p>{{ dialogMessage }}</p>
    <div class="dialog-actions">
      <button (click)="handleConfirmation(false)" class="cancel-btn">No</button>
      <button (click)="handleConfirmation(true)" class="confirm-btn">
        Yes
      </button>
    </div>
  </div>
</div>

<div class="sidebar" [ngClass]="{ active: sidebarOpen }">
  <ul class="nav-links">
    <li class="nav-link" *ngFor="let brand of getBrands()">
      <button class="dropdown-item" (click)="navigateToBrand(brand)">
        {{ brand | titlecase }}
      </button>
    </li>
  </ul>
  <form class="d-flex me-3" role="search" (submit)="onSearch()">
    <input
      class="form-control me-2 search-input"
      type="search"
      placeholder="Search..."
      [(ngModel)]="searchQuery"
      name="searchQuery"
      aria-label="Search"
      autocomplete="off"
    />
    <button class="btn btn-sm btn-outline-warning search-button" type="submit">
      Search
    </button>
  </form>
  <ul class="nav-links user-section">
    <li>
      <i class="fas fa-user"></i>
      <small>{{ loggedInUser?.firstName }} {{ loggedInUser?.lastName }}</small>
    </li>
    <button *ngIf="isLoggedIn()" class="nav-link" routerLink="profile">
      Profile
    </button>
    <button
      *ngIf="loggedInUser?.role === 'admin'"
      class="nav-link"
      routerLink="crudproducts"
    >
      Products
    </button>
    <button
      *ngIf="loggedInUser?.role === 'admin'"
      class="nav-link"
      routerLink="customers"
    >
      Customers
    </button>
    <button class="nav-link" routerLink="orders">Orders</button>
    <!-- <button
      *ngIf="loggedInUser?.role === 'user'"
      class="nav-link"
      routerLink="userOrders"
    >
      Orders
    </button> -->
    <button
      *ngIf="loggedInUser?.role === 'admin'"
      class="nav-link"
      routerLink="otherinfo"
    >
      Website Data
    </button>
    <button *ngIf="!isLoggedIn()" class="nav-link" routerLink="login">
      Login
    </button>
    <button *ngIf="!isLoggedIn()" class="nav-link" routerLink="register">
      Register
    </button>
    <button *ngIf="isLoggedIn()" class="nav-link" (click)="logout()">
      Logout
    </button>
  </ul>
  <ul class="nav-links justify-content-start align-items-start">
    <button class="icon-btn text-light" title="Wishlist" routerLink="wishlist">
      <i class="bi bi-heart"></i>
      <span *ngIf="wishlistCount > 0" class="badge rounded-pill bg-danger">
        {{ wishlistCount }}
      </span>
    </button>
    <button
      class="icon-btn position-relative text-light"
      title="Compare"
      routerLink="compare"
    >
      <i class="fa-solid fa-code-compare"></i>
      <span *ngIf="compareCount > 0" class="badge rounded-pill bg-danger">
        {{ compareCount }}
      </span>
    </button>

    <button
      class="icon-btn position-relative text-light"
      title="Cart"
      (click)="goToCart()"
    >
      <i class="bi bi-cart"></i>
      <span *ngIf="cartCount > 0" class="badge rounded-pill bg-danger">
        {{ cartCount }}
      </span>
    </button>
  </ul>
</div>

<nav class="navbar navbar-expand-lg shadow-sm">
  <a class="navbar-brand" routerLink="">
    <span class="text-warning">Mobile</span>
    <span class="text-light ms-1">Shop</span>
  </a>

  <!-- <button
    class="navbar-toggler"
    type="button"
    data-bs-toggle="collapse"
    data-bs-target="#navbarNav"
    aria-controls="navbarNav"
    aria-expanded="false"
    aria-label="Toggle navigation"
  >

    <span class="navbar-toggler-icon"></span>
  </button> -->
  <button
    class="navbar-toggler"
    type="button"
    data-bs-toggle="collapse"
    aria-expanded="false"
    aria-label="Toggle navigation"
    (click)="toggleSidebar()"
  >
    <i class="fas" [ngClass]="sidebarOpen ? 'fa-times' : 'fa-bars'"></i>
  </button>

  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
      <li class="nav-item" *ngFor="let brand of getBrands()">
        <button
          class="nav-link brandlink"
          (click)="navigateToBrand(brand)"
          routerLinkActive="active"
        >
          {{ brand | titlecase }}
        </button>
      </li>
    </ul>

    <form class="d-flex me-3" role="search" (submit)="onSearch()">
      <input
        class="form-control me-2 search-input"
        type="search"
        placeholder="Search products..."
        [(ngModel)]="searchQuery"
        name="searchQuery"
        aria-label="Search"
        autocomplete="off"
      />
      <button
        class="btn btn-sm btn-outline-warning search-button"
        type="submit"
      >
        Search
      </button>
    </form>

    <div class="d-flex justify-content-center">
      <button class="icon-btn me-3" title="Wishlist" routerLink="wishlist">
        <i class="bi bi-heart"></i>
        <span
          *ngIf="wishlistCount > 0"
          class="position-absolute top-0 start-85 translate-middle badge rounded-pill bg-danger"
          style="margin-top: 27px"
        >
          {{ wishlistCount }}
        </span>
      </button>
      <button
        class="icon-btn me-3 position-relative"
        title="Compare"
        routerLink="compare"
      >
        <i class="fa fa-code-compare"></i>
        <span
          *ngIf="compareCount > 0"
          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
        >
          {{ compareCount }}
        </span>
      </button>
      <button
        class="icon-btn me-3 position-relative"
        title="Cart"
        (click)="goToCart()"
      >
        <i class="bi bi-cart"></i>
        <span
          *ngIf="cartCount > 0"
          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
        >
          {{ cartCount }}
        </span>
      </button>

      <div class="dropdown">
        <button
          class="btn btn-outline-secondary dropdown-toggle"
          type="button"
          id="userDropdown"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          <i class="fas fa-user"></i>
          <small>{{ loggedInUser?.firstName }}</small>
        </button>
        <ul class="dropdown-menu" aria-labelledby="userDropdown">
          <li *ngIf="isLoggedIn()">
            <button class="dropdown-item" routerLink="profile">Profile</button>
          </li>
          <li *ngIf="loggedInUser?.role === 'admin'">
            <button class="dropdown-item" routerLink="crudproducts">
              Products
            </button>
          </li>
          <li *ngIf="loggedInUser?.role === 'admin'">
            <button class="dropdown-item" routerLink="customers">
              Customers
            </button>
          </li>
          <li>
            <button class="dropdown-item" routerLink="orders">Orders</button>
          </li>
          <!-- <li *ngIf="loggedInUser?.role === 'user'">
            <button class="dropdown-item" routerLink="userOrders">
              Orders
            </button>
          </li> -->
          <li *ngIf="loggedInUser?.role === 'admin'">
            <button class="dropdown-item" routerLink="otherinfo">
              Website Info
            </button>
          </li>
          <li *ngIf="!isLoggedIn()">
            <button class="dropdown-item" routerLink="login">Login</button>
          </li>
          <li *ngIf="!isLoggedIn()">
            <button class="dropdown-item" routerLink="register">
              Register
            </button>
          </li>
          <li *ngIf="isLoggedIn()">
            <button class="dropdown-item" (click)="logout()">Logout</button>
          </li>
        </ul>
      </div>
    </div>
  </div>
</nav>
